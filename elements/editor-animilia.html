<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../behaviors/toast-behavior.html">
<link rel="import" href="../behaviors/input-behavior.html">


<!-- componente <complaint-animilia> -->
<link rel="import" href="complaint-animilia.html">
<!-- componente <current-location.html> -->
<link rel="import" href="current-location.html">

<!-- imports que corresponden al componente <complaint-animilia> -->
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">

<!--
`editor-animilia`
editor con el que vamos poder guardar las denuncias, editarlas, etc

@demo demo/index.html 
-->

<dom-module id="editor-animilia">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

      <firebase-auth 
            app-name="form-polymerfire"
            id="auth" 
            user="{{user}}">
    </firebase-auth>
    
    <complaint-animilia
       
          identificador="{{complaint.identificador}}"     
          descripcion="{{complaint.descripcion}}"       
          inputs="{{inputs}}"
    ></complaint-animilia>

    <current-location
          address="{{complaint.address}}">
    </current-location>

     <paper-button id="saveButton" raised>guardar</paper-button>
     
         <firebase-query
            id="query"
            app-name="form-polymerfire"
            path="/denuncias/[[user.uid]]">
        </firebase-query>



  </template>

  <script>
    Polymer({

      is: 'editor-animilia',

      properties: {
         user:Object,
         logueado: Boolean,
         // objeto Complaint donde guardaremos todos los datos de la denuncia, que vienen bindeados desde el componente <complaint-animilia>
         complaint:{
          type:Object,
          value:function(){
            return{
          
              identificador:'',
              fecha:new Date().toLocaleString(),
              descripcion:'',
              address:''
            }
          }
          
         }
       
      },

      behaviors: [Polymer.inputBehavior],

      listeners:{
         'saveButton.tap': 'save',
     },

      // método para guardar los datos de la denuncia en Firebase
      save:function(){
   
        if(this.complaint.identificador && this.complaint.address && this.complaint.descripcion){
          // sube los datos de la denuncia a Firebase
          this.$.query.ref.push(this.complaint);
          this.fire('positive-toast', 'denúncia guardada')
          // después de introducir los valores en los input se limpia el texto
          this.complaint= {
           
            identificador:'',
            descripcion:'',
            fecha:'',
            address:''
          };
          
        }else{
          // al clickar en el botón 'guardar' se lanza el mètodo validator, incluido en el behavior, que valida los inputs
          for(var i = 0; i < this.inputs.length; i++ ){
              this.validator(this.inputs[i])
           };

        };          
                 

      },

    });
  </script>
</dom-module>
